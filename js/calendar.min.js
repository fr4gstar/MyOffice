$(document).ready(function(){function e(e){var t=new Date($("#createEventStart").val()),l=new Date($("#createEventEnd").val());$("#createEventTitle").val()||$("#createEventStart").val()||$("#createEventEnd").val()?t>=l?alert("Das Ende muss nach dem Startzeitpunkt angegeben werden!"):$.get("createCalendar.php",{title:$("#createEventTitle").val(),description:$("#createEventDescription").val(),start:$("#createEventStart").val(),end:$("#createEventEnd").val()},function(e){var t={title:$("#createEventTitle").val(),description:$("#createEventDescription").val(),start:$("#createEventStart").val(),end:$("#createEventEnd").val()};return console.log(t.start<t.end),"1"==e?(n(t),$("#fullcal").fullCalendar("renderEvent",t),$("#createEventDescription").val(""),alert("Event erfolgreich erstellt!"),console.log("Add event successfull!"),!0):(a(),alert("Event konnte nicht erstellt werden!"),console.log("ERROR: Add event failed!"),!1)}):alert("Bitte mindestens Titel, Start- und Enddatum (und Zeit) angeben!")}function t(e){$("#e_title"+e).val()&&$("#e_start"+e).val()&&$("#e_end"+e).val()?$.get("editCalendar.php",{eid:e,title:$("#e_title"+e).val(),description:$("#e_description"+e).val(),start:$("#e_start"+e).val(),end:$("#e_end"+e).val()},function(t){var a={eid:e,title:$("#e_title"+e).val(),description:$("#e_description"+e).val(),start:$("#e_start"+e).val(),end:$("#e_end"+e).val()};return"1"==t?($("#fullcal").fullCalendar("renderEvent",a),$("#fullcal").fullCalendar("removeEvents",a.eid),n(a),alert("Event erfolgreich angepasst!"),console.log("Edit event successfull!"),!0):(alert("Event konnte nicht angepasst werden!"),console.log("ERROR: Edit event failed!"),!1)}):alert("Bitte mindestens Titel, Start und Ende angeben!")}function a(){$.get("calendar.php",{},function(e){$("#ov_events").empty(),r(e),l(e),console.log("Update events successfull!")})}function n(e){$.get("calendar.php",{},function(t){var a=e.eid,n=e.title,r=e.description,i=e.start,d=e.end;$("#dialog_e"+a).length&&$("#dialog_e"+a).remove(),$("#fullcal").append("<div id='dialog_e"+a+"' class='dialog'><form><fieldset><label for='e_title"+a+"'>Title</label><input type='text' name='start' id='e_title"+a+"' value='"+n+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_start"+a+"'>Start</label><input type='text' name='start' id='e_start"+a+"' value='"+i+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_end"+a+"'>Ende</label><input type='text' name='end' id='e_end"+a+"' value='"+d+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_description"+a+"'>Beschreibung</label><br /><textarea name='note' id='e_description"+a+"' type='text' cols='40' rows='7' class='text ui-widget-content ui-corner-all'>"+r+"</textarea></fieldset></form></div>"),l(t);var o=Math.round((new Date(i)-new Date)/1e3/60/60),c="",s="",v="";72>o&&o>0&&(c=(new Date(i)-new Date)/1e3/60/60<o?"<":">",r.toString().length>100?(v=r.toString().substring(0,100),v+="..."):v=r,s+="<tr><td>"+c+o+"h</td><td>"+n+"</td><td>"+v+"</td><td>"+i+"</td><td>"+d+"</td></tr>"),$("#ov_eventTable").append(s),console.log("Update events successfull!")})}function l(e){var t=Object.keys(e).length;t-=1;var a="",n="";if(10>t)for(var l=0;t>l;l++){var r=e[t].title,i=e[t].description,d=e[t].start,o=e[t].end,c=Math.round((new Date(d)-new Date)/1e3/60/60),s="";72>c&&c>0&&(s=(new Date(d)-new Date)/1e3/60/60<c?"<":">",i.toString().length>100?(n=i.toString().substring(0,100),n+="..."):n=i,a+="<tr><td>"+s+c+"h</td><td>"+r+"</td><td>"+n+"</td><td>"+d+"</td><td>"+o+"</td></tr>"),t--}else for(var l=0;10>l;l++){var r=e[t].title,i=e[t].description,d=e[t].start,o=e[t].end,c=Math.round((new Date(d)-new Date)/1e3/60/60),s="";72>c&&c>0&&(s=(new Date(d)-new Date)/1e3/60/60<c?"<":">",i.toString().length>100?(n=i.toString().substring(0,100),n+="..."):n=i,a+="<tr><td>"+s+c+"h</td><td>"+r+"</td><td>"+n+"</td><td>"+d+"</td><td>"+o+"</td></tr>"),t--}$("#ov_eventTable").append(a)}function r(e){$("#ov_events").append("<table id='ov_eventTable' href='#'><tr><th>F&auml;llig in</th><th>Titel</th><th>Beschreibung</th><th>Start</th><th>Ende</th></tr></table>");var t=$.parseJSON(e),a=0,n="",r=[];for(n+="<div id='createEventDialog' class='dialog'><form><fieldset><label for='createEventTitle'>Title</label><input type='text' name='createEventTitle' id='createEventTitle' value='' class='text ui-widget-content ui-corner-all'><br /><label for='createEventStart"+i+"'>Start</label><input type='text' name='start' id='createEventStart' value='' class='text ui-widget-content ui-corner-all'><br /><label for='createEventEnd'>Ende</label><input type='text' name='createEventEnd' id='createEventEnd' value='' class='text ui-widget-content ui-corner-all'><br /><label for='createEventDescription'>Beschreibung</label><br /><textarea name='createEventDescription' id='createEventDescription' type='text' cols='40' rows='7' class='text ui-widget-content ui-corner-all'></textarea></fieldset></form></div>";t[a];){var i=t[a].id,d=t[a].title,o=t[a].description,c=t[a].start.split(/[- :]/);c=new Date(c[0],c[1]-1,c[2],c[3],c[4],c[5]);var s=t[a].end.split(/[- :]/);s=new Date(s[0],s[1]-1,s[2],s[3],s[4],s[5]),n+="<div id='dialog_e"+i+"' class='dialog'><form><fieldset><label for='e_title"+i+"'>Title</label><input type='text' name='start' id='e_title"+i+"' value='"+d+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_start"+i+"'>Start</label><input type='text' name='start' id='e_start"+i+"' value='"+c+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_end"+i+"'>Ende</label><input type='text' name='end' id='e_end"+i+"' value='"+s+"' class='text ui-widget-content ui-corner-all'><br /><label for='e_description"+i+"'>Beschreibung</label><br /><textarea name='note' id='e_description"+i+"' type='text' cols='40' rows='7' class='text ui-widget-content ui-corner-all'>"+o+"</textarea></fieldset></form></div>",r[i]=c-new Date,"-"==r[i].toString().substring(0,1)?(r[i]=r[i]/60/60/60,r[i]="-"+r[i]):r[i]=r[i]/60/60/60/60/60,a++}$("#fullcal").append(n),l(t)}$.datetimepicker.setLocale("de"),$("#calendar").append("<div id='fullcal'><div>"),$("#fullcal").fullCalendar({dayClick:function(t,a,n){$("#createEventDialog").dialog({autoOpen:!1,height:600,width:700,modal:!0,title:"Event erstellen",open:function(){"object"==$.type(t)&&(t=t.format(),$("#createEventStart").datetimepicker({startDate:new Date(t+" 10:00")}),$("#createEventEnd").datetimepicker({startDate:new Date(t+" 11:00")}),$("#createEventStart").val(t+" 10:00"),$("#createEventEnd").val(t+" 11:00"))},buttons:{Erstellen:function(){e(),$("#createEventDialog").dialog("close")}},close:function(){}}),$("#createEventDialog").dialog("open"),$("#createEventTitle").val("Neues Event"),"object"==$.type(t)&&(t=t.format(),$("#createEventStart").datetimepicker({startDate:new Date(t+" 10:00")}),$("#createEventEnd").datetimepicker({startDate:new Date(t+" 11:00")}),$("#createEventStart").val(t+" 10:00"),$("#createEventEnd").val(t+" 11:00"))},eventClick:function(e,n,r){var i=e.id;$("#dialog_e"+i).dialog({autoOpen:!1,height:600,width:700,modal:!0,title:"Event #"+i+" anpassen",open:function(){"object"==$.type(e)&&($("#e_start"+i).datetimepicker({startDate:e.start}),$("#e_end"+i).datetimepicker({startDate:e.end}),$("#e_start"+i).val(e.start),$("#e_end"+i).val(e.end))},buttons:{Speichern:function(){t(i)&&e.remove,$("#dialog_e"+i).dialog("close")},Entfernen:function(){$.get("deleteCalendar.php",{eid:e.id},function(t){"1"==t?($("#fullcal").fullCalendar("removeEvents",e.id),a(),alert("Event erfolgreich erstellt!"),console.log("Delete event successfull!")):(alert("Event konnte nicht erstellt werden!"),console.log("ERROR: Delete event failed!")),$("#dialog_e"+i).dialog("close"),l(t)})}},close:function(){}}),$("#dialog_e"+i).dialog("open"),$("#e_start"+i).datetimepicker({startDate:e.start}),$("#e_end"+i).datetimepicker({startDate:e.end}),$("#e_start"+i).val(e.start),$("#e_end"+i).val(e.end)},weekends:!0,aspectRatio:2,editable:!1,defaultDate:new Date,left:"",center:"",right:"today prev,next",eventSources:[{url:"calendar.php",type:"POST",error:function(){alert("There was an error while fetching events!")}}]}),$.get("calendar.php",{},function(e){$("#overview").append("<div id='ov_nextEvents' class='ov_header'>Demn&auml;chst anstehende Termine</div><div id='ov_events'></div>"),r(e)})});