jQuery(document).ready(function(){function t(t,e){if(!jQuery("#t_title"+t).val()||jQuery("#t_title"+t).val().toString().length>40||jQuery("#t_description"+t).val().toString().length>2e3||jQuery("#t_note"+t).val().toString().length>2e3)alert("Bitte den Titel angeben!");else{var a="00",n="00",r="00";e/60/60>=1&&(a=parseInt(e/60/60)),e/60>=1&&(n=e-parseInt(60*a*60),n=parseInt(n/60)),r=e-60*parseInt(a)*60-60*parseInt(n),e=a+":"+n+":"+r,jQuery.get("editTask.php",{tid:t,title:jQuery("#t_title"+t).val(),description:jQuery("#t_description"+t).val(),note:jQuery("#t_note"+t).val(),elapsedTime:e},function(t){"1"==t?(i(),alert("Aufgabe erfolgreich angepasst!"),console.log("Edit task successfull!")):(i(),alert("Aufgabe konnte nicht angepasst werden!"),console.log("ERROR: Edit task failed!"))})}}function e(e){jQuery("#ov_tasks").append("Aufgaben<table id='ov_taskTable' href='#'><tr><th>Titel</th><th>Beschreibung</th><th>Zeit</th></tr></table>"),jQuery("#showTasks").append("<table id='taskTable' href='#'><tr><th></th><th>#</th><th>Titel</th><th>Beschreibung</th><th>Notiz</th><th>Ben&ouml;tigte Zeit</th></tr></table>");for(var a=$.parseJSON(e),n=0,r="",s="";a[n];){var l=a[n].id,o=a[n].title,d="",u=a[n].description,d="",c=a[n].note,g="",p=a[n].elapsedTime;u.toString().length>40?(d=u.toString().substring(0,37),d+="..."):d=u,o.toString().length>40?(titleTeaser=o.toString().substring(0,37),titleTeaser+="..."):titleTeaser=o,c.toString().length>40?(g=c.toString().substring(0,37),g+="..."):g=c,r+="<div id='dialog_t"+l+"' class='dialog'><form><fieldset><label for='t_title'>Titel</label><input type='text' name='Titel' id='t_title"+l+"' maxlength='40' value='"+o+"' class='text ui-widget-content ui-corner-all'><br /><label for='t_description"+l+"'>Beschreibung</label><br /><textarea name='description' id='t_description"+l+"' type='text' cols='40' rows='5' maxlength='2000' class='text ui-widget-content ui-corner-all'>"+u+"</textarea><br /><label for='t_note"+l+"'>Notiz</label><br /><textarea name='note' id='t_note"+l+"' type='text' maxlength='2000' cols='40' rows='5' class='text ui-widget-content ui-corner-all'>"+c+"</textarea></fieldset></form><div id='timer"+l+"' class='timer'></div></div>",s+="<tr><td><button id='btn_viewTask"+l+"' class='opener' data-note='"+c+"' data-time='"+p+"'data-id='#dialog_t"+l+"'>Bearbeiten</button><button id='btn_deleteTask"+l+"' class='btn_delete'>L&ouml;schen</button></td><td>"+n+"</td><td>"+titleTeaser+"</td><td>"+d+"</td><td>"+g+"</td><td>"+p+"</td></tr>",n++}for(jQuery("#taskTable").append(s),jQuery("#showTasks").append(r),n=0;a[n];)jQuery("#btn_deleteTask"+a[n].id).click(function(){var t=$(this).attr("id");t=t.toString().substring(14,t.toString().length),jQuery.get("deleteTask.php",{tid:t},function(t){"1"==t?(i(),alert("Aufgabe erfolgreich entfernt!"),console.log("Delete task successfull!")):(alert("Aufgabe konnte nicht entfernt werden!"),console.log("Delete task error!"))})}),n++;$(".dialog").dialog({autoOpen:!1}),$(".opener").click(function(){var e=$(this).data("id"),i=e.toString().substring(8,9);if("t"==i){var a,n=e.toString().substring(9,e.toString().length),r=($(this).data("note"),$("#timer"+n).FlipClock({autoStart:!1,language:"de"})),s=$(this).data("time");if("00:00:00"!=s){var l=s.split(":");a=60*+l[0]*60+60*+l[1]+ +l[2]}else a=0;r.setTime(a),$(e).dialog({autoOpen:!1,height:700,width:700,modal:!0,title:"Aufgabe #"+n+" anpassen",buttons:{Start:function(){r.start()},Stop:function(){r.stop()},Reset:function(){alert("Hinweis: Die bereits verstrichene Zeit wird auf 00:00:00 gesetzt - Fenster schliessen um abzubrechen!"),r.reset()},Speichern:function(){t(n,r.getTime().time),$(e).dialog("close")}},close:function(){}}),$(e).dialog("open")}});var h=Object.keys(a).length-1,b="",f="";if(5>h)for(var k=0;h>k;k++)a[h].description.toString().length>20?(f=a[h].description.toString().substring(0,20),f+="..."):f=a[h].description,b+="<tr><td>"+a[h].title+"</td><td>"+f+"</td><td>"+a[h].elapsedTime+"</td></tr>",h--;else for(var k=0;5>k;k++)a[h].description.toString().length>20?(f=a[h].description.toString().substring(0,20),f+="..."):f=a[h].description,b+="<tr><td>"+a[h].title+"</td><td>"+f+"</td><td>"+a[h].elapsedTime+"</td></tr>",h--;jQuery("#ov_taskTable").append(b)}function i(){jQuery.get("tasks.php",{},function(t){jQuery("#showTasks").empty(),jQuery("#ov_tasks").empty(),e(t),console.log("Update task successfull!")})}jQuery.get("tasks.php",{},function(t){jQuery("#tasks").append("<div id='tabs_tasks'><ul><li><a href='#showTasks'>Aufgaben anzeigen</a></li><li><a href='#createTask'>Aufgabe erstellen</a></li></ul><div id='showTasks'></div><div id='createTask'></div></div>"),$(function(){$("#tabs_tasks").tabs()}),e(t),jQuery("#createTask").append("Titel<input id='task_title' type='text' maxlength='40'></input><br/>Beschreibung<br/><textarea id='task_description' type='text' cols='40' rows='5' maxlength='2000'></textarea><br/><button id='btn_createTask' class='btn_add'>Aufgabe erstellen</button>"),jQuery("#btn_createTask").click(function(){!jQuery("#task_title").val()||jQuery("#task_title").val().toString().length>40||jQuery("#task_description").val().toString().length>2e3?alert("Titel(muss angegeben sein) oder Beschreibung zu lang!"):jQuery.get("createTask.php",{title:jQuery("#task_title").val(),description:jQuery("#task_description").val()},function(t){"1"==t?(jQuery("#task_title").val(""),jQuery("#task_description").val(""),i(),alert("Aufgabe erfolgreich erstellt!"),console.log("Create task successfull!")):(alert("Aufgabe konnte nicht erstellt werden!"),console.log("ERROR: Create task successfull!"))})})})});